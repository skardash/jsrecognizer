<!DOCTYPE html>

<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Convolutional nets</title>
  <meta name="description" content="">
  <meta name="author" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
.layer {
  border: 1px solid #999;
  margin-bottom: 5px;
  text-align: left;
  padding: 10px;
}
.layer_act {
  width: 500px;
  float: right;
}
.ltconv {
  background-color: #FDD;
}
.ltrelu {
  background-color: #FDF;
}
.ltpool {
  background-color: #DDF;
}
.ltsoftmax {
  background-color: #FFD;
}
.ltfc {
  background-color: #DFF;
}
.ltlrn {
  background-color: #DFD; 
}
.ltdropout {
  background-color: #AAA;  
}
.ltitle {
  color: #333;
  font-size: 18px;
}
.actmap {
  margin: 1px;
}
#trainstats {
  text-align: left;
}
.clear {
  clear: both;
}
#wrap {
  width: 800px;
  margin-left: auto;
  margin-right: auto;
}
h1 {
  font-size: 16px;
  color: #333;
  background-color: #DDD;
  border-bottom: 1px #999 solid;
  text-align: center;
}
.secpart {
  width: 400px;
  float: left;
}
#lossgraph {
  /*border: 1px solid #F0F;*/
  width: 100%;
}
.probsdiv canvas {
  float: left;
}
.probsdiv {
  height: 60px;
  width: 180px;
  display: inline-block;
  font-size: 12px;
  box-shadow: 0px 0px 2px 2px #EEE;
  margin: 5px;
  padding: 5px;
  color: black;
}
.pp {
  margin: 1px;
  padding: 1px;
}
#testset_acc {
  margin-bottom: 200px;
}
</style>

<script src="jquery-1.8.3.min.js"></script>
<style type="text/css"></style>
<script src="vis.js"></script>
<script src="util.js"></script>
<script src="convnet.js"></script>
<script src="mnist_labels.js"></script>

<script>
//wtf
// ------------------------
// BEGIN MNIST SPECIFIC STUFF
// ------------------------
classes_txt = ['just circle', 'circle and eyes', 'circle and mouth', 'арийский колобок', 'колобок-инвалид'];

var use_validation_data = true;

var data_new;
var dt, lbl;
var foo, foo_start;
var curr_ix;
var data_loaded = false;
var dt_sep, lbl_sep;
var train_data, test_data;
var ixx = 0;
train_data = new Object();
test_data = new Object();

//load_dt('http://mrtgo.com/dirtmp/data.txt');
//load_lbl('http://mrtgo.com/dirtmp/labels.txt');
var intervalID; // = setInterval(alrt, 1000);

function get_random_int(min, max)
{
  return Math.floor(Math.random() * (max - min + 1)) + min;
}

function split_data(tst_share) {
	var ix = Math.floor(dt_sep.length * (1 - tst_share));
	train_data.dt = [];
	train_data.lbl = [];
	test_data.dt = [];
	test_data.lbl = [];
	for (var cnt=0; cnt<ix; cnt++) {
		train_data.dt.push(dt_sep[foo_start[cnt]]);
		train_data.lbl.push(lbl_sep[foo_start[cnt]]);
	}
	for (var cnt=ix; cnt<dt_sep.length; cnt++) {
		test_data.dt.push(dt_sep[foo_start[cnt]]);
		test_data.lbl.push(lbl_sep[foo_start[cnt]]);
	}
	/*
	train_data.dt = dt_sep.slice(0,ix);
	train_data.lbl = lbl_sep.slice(0,ix);
	test_data.dt = dt_sep.slice(ix, dt_sep.length);
	test_data.lbl = lbl_sep.slice(ix, dt_sep.length);
	*/
}

function get_array(dt) {
	//var str = "14 2\n6 7";
	//alert(dt);
	var myArray = dt.split("\n"); 
	myArray.splice(myArray.length-1,1);
	for(var i=0; i<myArray.length; i++) { 
		myArray[i] = myArray[i].split(" ");
		for(var j=0; j<myArray[i].length; j++) {
			myArray[i][j] = +myArray[i][j]; 
			//alert(myArray[i][j]);
		}
	} 
	return myArray;
}

function get_array_lbl(dt) {
	var myArray = dt.split("\n"); 
	myArray.splice(myArray.length-1,1);
	for(var i=0; i<myArray.length; i++) { 
		myArray[i] = +myArray[i]; 
	} 
	return myArray;
}


function reshape(img_arr,height,width) {
	var arr2d = [];
	if (img_arr.length != height*width) {	
		alert('size is wrong: img size: ' + String(img_arr.length) + ' height = ' + String(height) + ' width = ' + String(width));
		return [];
	}
	for (var i=0; i<height; i++) {
		var tmp = [];
		arr2d.push(img_arr.slice(i*width,((i+1)*width)));
	}
	//alert(arr2d[0]);
	return arr2d;
}

function to_canvas(id,dt) {
	var ctx = document.getElementById(id).getContext("2d");
	var w = dt[0].length;
	var h = dt.length;
	ctx.canvas.height = h;
	ctx.canvas.width = w;
	//alert('height = ' + String(h) + ' width = ' + String(w));
	var imgData = ctx.getImageData(0, 0, w, h);
	var data = imgData.data;
	for(var i = 0; i < h; i++) {
		for(var j = 0; j < w; j++) {
			data[4 * i * w + 4 * j + 3] = dt[i][j];
		}
	}
	ctx.putImageData(imgData, 0, 0);
}

// load all the data (training and testing, labels) at once
function load_dt(url_dt) {
	var request = new XMLHttpRequest();
	//request.open('GET', 'http://mrtgo.com/numbers.txt', true);
	request.open('GET', url_dt, true);
	request.onreadystatechange = function() {
		// Makes sure the document is ready to parse.
		if(request.readyState == 4) {
			// Makes sure it's found the file.
			if(request.status == 200) {
				data_txt = request.responseText;
				data_new = get_array(data_txt);
				data_loaded = true;
				//alert(data);
				//alert(data);
				//show_array(data);
				//$("textarea#ExampleMessage").val(data);
				//img_shaped = reshape(data[1],24,24);
				//alert('data reshaped');
				//to_canvas('mycanv', img_shaped);
				//alert(data[0].length);
				//show_canvas_content('mycanv');
			}
		}
	};
	request.send(null);
}

var network_saved;
var network_loaded = false;

function load_network() {
	var request = new XMLHttpRequest();
	//request.open('GET', 'http://mrtgo.com/numbers.txt', true);
	request.open('GET', 'http://mrtgo.com/jscode/dirtmp/network.txt', true);
	request.onreadystatechange = function() {
		// Makes sure the document is ready to parse.
		if(request.readyState == 4) {
			// Makes sure it's found the file.
			if(request.status == 200) {
				network_saved = request.responseText;
				network_loaded = true;
				//alert(data);
				//alert(data);
				//show_array(data);
				//$("textarea#ExampleMessage").val(data);
				//img_shaped = reshape(data[1],24,24);
				//alert('data reshaped');
				//to_canvas('mycanv', img_shaped);
				//alert(data[0].length);
				//show_canvas_content('mycanv');
			}
		}
	};
	request.send(null);
}


function permute(input) {
	input.sort(function() {
	   return Math.random() - 0.5;
	});
	return input;
};


function init_order_start() {
	foo_start = new Array(dt_sep.length);
	for (var i = 0; i < foo_start.length; i++) {
		foo_start[i] = i; 
	}
	foo_start = permute(foo_start);
}

// write sampling procedures
function init_order() {
	foo = new Array(train_data.dt.length);
	for (var i = 0; i < foo.length; i++) {
		foo[i] = i; 
	}
	foo = permute(foo);
}

function sample_training_instance_my(ix) {
	var ixr = foo[ix];
	x = convnetjs.augment(train_data.dt[ixr], 24);
	//alert('now the data will be shown, index = ' + String(ixr));
	//show_data(x);
	var isval = use_validation_data && ix%10===0 ? true : false;
	return {x:x, label:train_data.lbl[ixr], isval:isval};
}

function sample_training_instance_certain(ix) {
	x = convnetjs.augment(train_data.dt[ix], 24);
	//alert('now the data will be shown, index = ' + String(ixr));
	//show_data(x);
	var isval = use_validation_data && ix%10===0 ? true : false;
	return {x:x, label:train_data.lbl[ix], isval:isval};
}

/*
function sample_testing_instance_my(ix) {
	var ixr = foo[ix];
	x = convnetjs.augment(train_data.dt[ixr], 24);
	alert('now the data will be shown, index = ' + String(ixr));
	show_data(x);
	var isval = use_validation_data && ix%10===0 ? true : false;
	return {x:x, label:test_data.lbl[ixr], isval:isval};
}
*/

function sleep(delay) {
	var start = new Date().getTime();
	while (new Date().getTime() < start + delay);
}

function fi_convert(dt) {
	var arr = new Array(dt.length);
	for(var i=0; i<dt.length; i++) {
		arr[i] = Math.floor(dt[i]*255.0);
	}
	return arr;
}

function separate_data() {
	var sample, row_dt;
	dt_sep = [];
	lbl_sep = [];
	for (var cnt = 0; cnt < data_new.length; cnt++) {
		sample = data_new[cnt];
		row_dt = sample.slice(0, sample.length-1);
		var x = new convnetjs.Vol(28,28,1,0.0);
		var W = 28*28;
		for(var i=0;i<W;i++) {
			x.w[i] = row_dt[i]/255.0;
		}
		dt_sep.push(x);
		lbl_sep.push(sample[sample.length-1]);
	}
	//alert('data separated: ' + String(dt_sep.length) + '/' + String(lbl_sep.length));
}

function show_data(x) {
	var smpl = x.w;
	var str = '';
	for (var cnt=0; cnt<smpl.length; cnt++) {
		str += String(smpl[cnt]) + ' ';
	}
	alert(str);
}

function init_network() {
	var layer_defs = [];
	layer_defs.push({type:'input', out_sx:24, out_sy:24, out_depth:1});
	layer_defs.push({type:'conv', sx:5, filters:8, stride:1, activation:'relu'});
	layer_defs.push({type:'pool', sx:2, stride:2});
	layer_defs.push({type:'conv', sx:5, filters:16, stride:1, activation:'relu'});
	layer_defs.push({type:'pool', sx:3, stride:3, drop_prob: 0.5});
	layer_defs.push({type:'softmax', num_classes:10});
	document.getElementById('newnet').value = JSON.stringify(layer_defs, undefined, 1);
	net = new convnetjs.Net();
	net.makeLayers(layer_defs);
	trainer = new convnetjs.SGDTrainer(net, {learning_rate:0.1, momentum:0.9, batch_size:16, l2_decay:0.001});
	update_net_param_display();
}

function alrt() {
	if (data_loaded) {
		clearInterval(intervalID);
		//alert("data loaded");
		separate_data();
		init_order_start();
		split_data(0.1);
		init_network();
		init_order();
		//alert(train_data.dt.length);
		setInterval(step_async, 0);
		//train(30);
		
		
		/*
		init_order();
		clearInterval(intervalID);
		var data_sample = data_new[1];
		var dt = data_sample.slice(0,data_sample.length-1);
		var lbl = data_sample[data_sample.length-1];
		alert(dt.length);
		img_shaped = reshape(dt,28,28);
		to_canvas('mycanv', img_shaped);
		train(4);
		*/
	}
}

function run_epoch() {
	for (var cnt = 0; cnt < foo.length; cnt++) {
		var sample = sample_training_instance_my(cnt);
		step(sample);
	}
}

paused = false;
function step_async() {
	if(paused) return; 
	curr_ix = foo[ixx];
	var sample = sample_training_instance_my(curr_ix);
	step(sample);
	ixx++;
	if (ixx >= train_data.dt.length) {
		foo = permute(foo);
		ixx = 0;
	}
}

function train(epochs) {
	//alert('start training');
	init_order();
	//alert('index initialized: ' + String(foo));
	for (var cnt=0; cnt<epochs; cnt++) {
		foo = permute(foo);
		//alert('epoch ' + String(cnt+1) + ' in progress');
		run_epoch();
	}
}


var sample_training_instance = function() {
  // find an unloaded batch
  var bi = Math.floor(Math.random()*loaded_train_batches.length);
  var b = loaded_train_batches[bi];
  var k = Math.floor(Math.random()*3000); // sample within the batch
  var n = b*3000+k;

  // load more batches over time
  if(step_num%5000===0 && step_num>0) {
    for(var i=0;i<num_batches;i++) {
      if(!loaded[i]) {
        // load it
        load_data_batch(i);
        break; // okay for now
      }
    }
  }

  // fetch the appropriate row of the training image and reshape into a Vol
  var p = img_data[b].data;
  var x = new convnetjs.Vol(28,28,1,0.0);
  var W = 28*28;
  for(var i=0;i<W;i++) {
    var ix = ((W * k) + i) * 4;
    x.w[i] = p[ix]/255.0;
  }
  x = convnetjs.augment(x, 24);

  var isval = use_validation_data && n%10===0 ? true : false;
  return {x:x, label:labels[n], isval:isval};
}

var sample_test_instance_my = function() {
	var ix = Math.floor(Math.random()*test_data.dt.length);
	var xs = [];
	var x = test_data.dt[ix];
	for(var i=0;i<4;i++) {
		xs.push(convnetjs.augment(x, 24));
	}
	return {x:xs, label:test_data.lbl};
}


// sample a random testing instance
var sample_test_instance = function() {
  var b = 20;
  var k = Math.floor(Math.random()*3000);
  var n = b*3000+k;

  var p = img_data[b].data;
  var x = new convnetjs.Vol(28,28,1,0.0);
  var W = 28*28;
  for(var i=0;i<W;i++) {
    var ix = ((W * k) + i) * 4;
    x.w[i] = p[ix]/255.0;
  }
  var xs = [];
  for(var i=0;i<4;i++) {
    xs.push(convnetjs.augment(x, 24));
  }
  // return multiple augmentations, and we will average the network over them
  // to increase performance
  return {x:xs, label:labels[n]};
}


/*
// sample a random testing instance
var sample_test_instance = function() {
  var b = 20;
  var k = Math.floor(Math.random()*3000);
  var n = b*3000+k;

  var p = img_data[b].data;
  var x = new convnetjs.Vol(28,28,1,0.0);
  var W = 28*28;
  for(var i=0;i<W;i++) {
    var ix = ((W * k) + i) * 4;
    x.w[i] = p[ix]/255.0;
  }
  var xs = [];
  for(var i=0;i<4;i++) {
    xs.push(convnetjs.augment(x, 24));
  }
  // return multiple augmentations, and we will average the network over them
  // to increase performance
  return {x:xs, label:labels[n]};
}
*/

/*
var num_batches = 21; // 20 training batches, 1 test
var data_img_elts = new Array(num_batches);
var img_data = new Array(num_batches);
var loaded = new Array(num_batches);
var loaded_train_batches = [];
*/
// int main

$(window).load(function() {
	load_dt('http://mrtgo.com/dirtmp/data.txt');
	intervalID = setInterval(alrt, 1000);
});


var start_fun = function() {
  if(loaded[0] && loaded[20]) { 
    console.log('starting!'); 
    setInterval(load_and_step, 0); // lets go!
  }
  else { setTimeout(start_fun, 200); } // keep checking
}

var put_data = function(dt) {
	var arr = new Array(100);
	for (var cnt=0; cnt<100; cnt++) {
		arr[cnt] = dt[cnt];
	}
	$("textarea#data_output").val(arr);
}

var load_data_batch = function(batch_num) {
  // Load the dataset with JS in background
  data_img_elts[batch_num] = new Image();
  var data_img_elt = data_img_elts[batch_num];
  data_img_elt.onload = function() { 
    var data_canvas = document.createElement('canvas');
    data_canvas.width = data_img_elt.width;
    data_canvas.height = data_img_elt.height;
    var data_ctx = data_canvas.getContext("2d");
    data_ctx.drawImage(data_img_elt, 0, 0); // copy it over... bit wasteful :(
    img_data[batch_num] = data_ctx.getImageData(0, 0, data_canvas.width, data_canvas.height);
	
	put_data(img_data[batch_num].data);
	//$("textarea#data_output").val(String(img_data[batch_num].data)); //my code
	
    loaded[batch_num] = true;
    if(batch_num < 20) { loaded_train_batches.push(batch_num); }
    console.log('finished loading data batch ' + batch_num);
  };
  data_img_elt.src = "mnist/mnist_batch_" + batch_num + ".png";
}

// ------------------------
// END MNIST SPECIFIC STUFF
// ------------------------

var maxmin = cnnutil.maxmin;
var f2t = cnnutil.f2t;

// elt is the element to add all the canvas activation drawings into
// A is the Vol() to use
// scale is a multiplier to make the visualizations larger. Make higher for larger pictures
// if grads is true then gradients are used instead
var draw_activations = function(elt, A, scale, grads) {

  
}

var visualize_activations = function(net, elt) {

  // clear the element
  elt.innerHTML = "";

  // show activations in each layer
  var N = net.layers.length;
  for(var i=0;i<N;i++) {
    var L = net.layers[i];

    var layer_div = document.createElement('div');

    // visualize activations
	
    var activations_div = document.createElement('div');
    activations_div.appendChild(document.createTextNode('Activations:'));
    activations_div.appendChild(document.createElement('br'));
    activations_div.className = 'layer_act';
    var scale = 2;
    if(L.layer_type==='softmax' || L.layer_type==='fc') scale = 10; // for softmax
    draw_activations(activations_div, L.out_act, scale);

    // visualize filters if they are of reasonable size
    if(L.layer_type === 'conv') {
      var filters_div = document.createElement('div');
      if(L.filters[0].sx>3) {
        // actual weights
        filters_div.appendChild(document.createTextNode('Weights:'));
        filters_div.appendChild(document.createElement('br'));
        for(var j=0;j<L.filters.length;j++) {
          draw_activations(filters_div, L.filters[j], 2);
        }
        // gradients
        filters_div.appendChild(document.createElement('br'));
        filters_div.appendChild(document.createTextNode('Gradients:'));
        filters_div.appendChild(document.createElement('br'));
        for(var j=0;j<L.filters.length;j++) {
          draw_activations(filters_div, L.filters[j], 2, true);
        }
      } else {
        filters_div.appendChild(document.createTextNode('Weights hidden, too small'));
      }
      activations_div.appendChild(filters_div);
    }
    layer_div.appendChild(activations_div);

    // print some stats on left of the layer
    layer_div.className = 'layer ' + 'lt' + L.layer_type;
    var title_div = document.createElement('div');
    title_div.className = 'ltitle'
    var t = L.layer_type + ' (' + L.out_sx + 'x' + L.out_sy + 'x' + L.out_depth + ')';
    title_div.appendChild(document.createTextNode(t));
    layer_div.appendChild(title_div);

    if(L.layer_type==='conv') {
      var t = 'filter size ' + L.filters[0].sx + 'x' + L.filters[0].sy + 'x' + L.filters[0].depth + ', stride ' + L.stride;
      layer_div.appendChild(document.createTextNode(t));
      layer_div.appendChild(document.createElement('br'));
    }
    if(L.layer_type==='pool') {
      var t = 'pooling size ' + L.sx + 'x' + L.sy + ', stride ' + L.stride;
      layer_div.appendChild(document.createTextNode(t));
      layer_div.appendChild(document.createElement('br'));
    }

    // find min, max activations and display them
    var mma = maxmin(L.out_act.w);
    var t = 'max activation: ' + f2t(mma.maxv) + ', min: ' + f2t(mma.minv);
    layer_div.appendChild(document.createTextNode(t));
    layer_div.appendChild(document.createElement('br'));

    // number of parameters
    if(L.layer_type==='conv') {
      var tot_params = L.sx*L.sy*L.in_depth*L.filters.length + L.filters.length;
      var t = 'parameters: ' + L.filters.length + 'x' + L.sx + 'x' + L.sy + 'x' + L.in_depth + '+' + L.filters.length + ' = ' + tot_params;
      layer_div.appendChild(document.createTextNode(t));
      layer_div.appendChild(document.createElement('br'));
    }
    if(L.layer_type==='fc') {
      var tot_params = L.num_inputs*L.filters.length + L.filters.length;
      var t = 'parameters: ' + L.filters.length + 'x' + L.num_inputs + '+' + L.filters.length + ' = ' + tot_params;
      layer_div.appendChild(document.createTextNode(t));
      layer_div.appendChild(document.createElement('br'));
    }

    // css madness needed here...
    var clear = document.createElement('div');
    clear.className = 'clear';
    layer_div.appendChild(clear);

    elt.appendChild(layer_div);
  }
}

// loads a training image and trains on it with the network
var paused = false;
var load_and_step = function() {
  if(paused) return; 

  var sample = sample_training_instance();
  step(sample); // process this image
}

function predict_single() {
	var sample = sample_training_instance_certain(410);
	var x = sample.x;
	net.forward(x);
    var yhat = net.getPrediction();
	var strange_data = sample.x.w;
	alert(strange_data);
	var recoded = new Array(strange_data.length);
	for (var cnt = 0; cnt < strange_data.length; cnt++) {
		recoded[cnt] = strange_data[cnt];
	}
	var rs = fi_convert(recoded);
	rs = reshape(rs,24,24);
	to_canvas('mycanv', rs);
	alert(yhat);
	//output the image to canvas
	//output the class given to it
	return yhat;
	//plot data
	//run prediction
}

// evaluate current network on test set
var test_predict = function() {
  var num_classes = net.layers[net.layers.length-1].out_depth;

  document.getElementById('testset_acc').innerHTML = '';
  // grab a random test image
  for(num=0;num<50;num++) {
    //var sample = sample_test_instance();
	var sample = sample_test_instance_my();
    var y = sample.label;  // ground truth label

    // forward prop it through the network
    var aavg = new convnetjs.Vol(1,1,num_classes,0.0);
    // ensures we always have a list, regardless if above returns single item or list
    var xs = [].concat(sample.x);
    var n = xs.length;
    for(var i=0;i<n;i++) {
      var a = net.forward(xs[i]);
      aavg.addFrom(a);
    }
    var preds = [];
    for(var k=0;k<aavg.w.length;k++) { preds.push({k:k,p:aavg.w[k]}); }
    preds.sort(function(a,b){return a.p<b.p ? 1:-1;});
    
    var div = document.createElement('div');
    div.className = 'testdiv';

    // draw the image into a canvas
    draw_activations(div, xs[0], 2); // draw Vol into canv

    // add predictions
    var probsdiv = document.createElement('div');
    div.className = 'probsdiv';
    var t = '';
    for(var k=0;k<3;k++) {
      var col = preds[k].k===y ? 'rgb(85,187,85)' : 'rgb(187,85,85)';
      t += '<div class=\"pp\" style=\"width:' + Math.floor(preds[k].p/n*100) + 'px; margin-left: 60px; background-color:' + col + ';\">' + classes_txt[preds[k].k-1] + '</div>'
    }
    probsdiv.innerHTML = t;
    div.appendChild(probsdiv);

    // add it into DOM
    $("#testset_acc").append(div).fadeIn(1000);
  }
}


var lossGraph = new cnnvis.Graph();
var xLossWindow = new cnnutil.Window(100);
var wLossWindow = new cnnutil.Window(100);
var trainAccWindow = new cnnutil.Window(100);
var valAccWindow = new cnnutil.Window(100);
var step_num = 0;
var step = function(sample) {

  var x = sample.x;
  var y = sample.label;

  if(sample.isval) {
    // use x to build our estimate of validation error
    net.forward(x);
    var yhat = net.getPrediction();
    var val_acc = yhat === y ? 1.0 : 0.0;
    valAccWindow.add(val_acc);
    return; // get out
  }

  // train on it with network
  var stats = trainer.train(x, y);
  var lossx = stats.cost_loss;
  var lossw = stats.l2_decay_loss;

  // keep track of stats such as the average training error and loss
  var yhat = net.getPrediction();
  var train_acc = yhat === y ? 1.0 : 0.0;
  xLossWindow.add(lossx);
  wLossWindow.add(lossw);
  trainAccWindow.add(train_acc);

  // visualize training status
  var train_elt = document.getElementById("trainstats");
  train_elt.innerHTML = '';
  var t = 'Forward time per example: ' + stats.fwd_time + 'ms';
  train_elt.appendChild(document.createTextNode(t));
  train_elt.appendChild(document.createElement('br'));
  var t = 'Backprop time per example: ' + stats.bwd_time + 'ms';
  train_elt.appendChild(document.createTextNode(t));
  train_elt.appendChild(document.createElement('br'));
  var t = 'Classification loss: ' + f2t(xLossWindow.get_average());
  train_elt.appendChild(document.createTextNode(t));
  train_elt.appendChild(document.createElement('br'));
  var t = 'L2 Weight decay loss: ' + f2t(wLossWindow.get_average());
  train_elt.appendChild(document.createTextNode(t));
  train_elt.appendChild(document.createElement('br'));
  var t = 'Training accuracy: ' + f2t(trainAccWindow.get_average());
  train_elt.appendChild(document.createTextNode(t));
  train_elt.appendChild(document.createElement('br'));
  var t = 'Validation accuracy: ' + f2t(valAccWindow.get_average());
  train_elt.appendChild(document.createTextNode(t));
  train_elt.appendChild(document.createElement('br'));
  var t = 'Examples seen: ' + step_num;
  train_elt.appendChild(document.createTextNode(t));
  train_elt.appendChild(document.createElement('br'));

  // visualize activations
  if(step_num % 100 === 0) {
    var vis_elt = document.getElementById("visnet");
    visualize_activations(net, vis_elt);
  }

  // log progress to graph, (full loss)
  if(step_num % 200 === 0) {
    var xa = xLossWindow.get_average();
    var xw = wLossWindow.get_average();
    if(xa >= 0 && xw >= 0) { // if they are -1 it means not enough data was accumulated yet for estimates
      lossGraph.add(step_num, xa + xw);
      lossGraph.drawSelf(document.getElementById("lossgraph"));
    }
  }

  // run prediction on test set
  if(step_num % 1000 === 0) {
    test_predict();
  }
  step_num++;
}

// user settings 
var change_lr = function() {
  trainer.learning_rate = parseFloat(document.getElementById("lr_input").value);
  update_net_param_display();
}
var change_momentum = function() {
  trainer.momentum = parseFloat(document.getElementById("momentum_input").value);
  update_net_param_display();
}
var change_batch_size = function() {
  trainer.batch_size = parseFloat(document.getElementById("batch_size_input").value);
  update_net_param_display();
}
var change_decay = function() {
  trainer.l2_decay = parseFloat(document.getElementById("decay_input").value);
  update_net_param_display();
}
var update_net_param_display = function() {
  document.getElementById('lr_input').value = trainer.learning_rate;
  document.getElementById('momentum_input').value = trainer.momentum;
  document.getElementById('batch_size_input').value = trainer.batch_size;
  document.getElementById('decay_input').value = trainer.l2_decay;
}
var toggle_pause = function() {
  paused = !paused;
  var btn = document.getElementById('buttontp');
  if(paused) { btn.value = 'resume' }
  else { btn.value = 'pause'; }
}
var dump_json = function() {
  document.getElementById("dumpjson").value = JSON.stringify(net.toJSON());
}

var dump_json_server = function() {
	var network_string = JSON.stringify(net.toJSON());
	$.post("save_network.php", {
		net : network_string,
		file_name: "double_size.txt"
	});
	//document.getElementById("dumpjson_srvr").value = JSON.stringify(net.toJSON());
}

var clear_graph = function() {
  lossGraph = new cnnvis.Graph(); // reinit graph too 
}
var reset_all = function() {
  // reinit trainer
  trainer = new convnetjs.SGDTrainer(net, {learning_rate:trainer.learning_rate, momentum:trainer.momentum, batch_size:trainer.batch_size, decay:trainer.l2_decay});
  update_net_param_display();

  // reinit windows that keep track of val/train accuracies
  xLossWindow.reset();
  wLossWindow.reset();
  trainAccWindow.reset();
  valAccWindow.reset();
  lossGraph = new cnnvis.Graph(); // reinit graph too
  step_num = 0;
}
var load_from_json = function() {
  var jsonString = document.getElementById("dumpjson").value;
  var json = JSON.parse(jsonString);
  net = new convnetjs.Net();
  net.fromJSON(json);
  reset_all();
}

var net_inter;
var put_network = function() {
	if (!network_loaded) 
		return;
	network_saved = network_saved.replace(/\\/g, '');
	document.getElementById("dumpjson").value = network_saved;
	network_loaded = false;
	clearInterval(net_inter);
	//put loaded network to the frame
	//clear interval
	//set loaded flag to false
}

var load_from_server = function() {
	load_network();
	net_inter = setInterval(put_network,100);
	/*
	var json = JSON.parse(jsonString);
	net = new convnetjs.Net();
	net.fromJSON(json);
	reset_all();
	*/
}

var change_net = function() {
  var layer_defs_txt = document.getElementById('newnet').value;
  var layer_defs = JSON.parse(layer_defs_txt);
  net = new convnetjs.Net();
  net.makeLayers(layer_defs);
  reset_all();
}


</script></head>













<body>
  <div id="wrap">
  <h1>Training Stats</h1>
  <div class="divsec" style="270px;">
    <div class="secpart">
      Current image: <img id="input_image" src=""><input id="buttontp" type="submit" value="pause" onclick="toggle_pause();">
      <div id="trainstats">Forward time per example: 5ms<br>Backprop time per example: 4ms<br>Classification loss: 0.78705<br>L2 Weight decay loss: 0.00194<br>Training accuracy: 0.7<br>Validation accuracy: 0.84<br>Examples seen: 3883<br></div>

      <div id="controls">
        Learning rate: <input name="lri" type="text" maxlength="20" id="lr_input">
        <input id="buttonlr" type="submit" value="change" onclick="change_lr();">
        <br>

        Momentum: <input name="momi" type="text" maxlength="20" id="momentum_input">
        <input id="buttonmom" type="submit" value="change" onclick="change_momentum();">
        <br>

        Batch size: <input name="bsi" type="text" maxlength="20" id="batch_size_input">
        <input id="buttonbs" type="submit" value="change" onclick="change_batch_size();">
        <br>

        Weight decay: <input name="wdi" type="text" maxlength="20" id="decay_input">
        <input id="buttonwd" type="submit" value="change" onclick="change_decay();">
      </div>

      <input id="buttondj" type="submit" value="save network snapshot as JSON" onclick="dump_json();"><br>
      <input id="buttonlfj" type="submit" value="init network from JSON snapshot" onclick="load_from_json();"><br>
	  <input id="button_srvr" type="submit" value="save network snapshot to server" onclick="dump_json_server();"><br>
	  <input id="button_srvr" type="submit" value="load network snapshot from server" onclick="load_from_server();"><br>
	  <input id="rec_random" type="submit" value="recognize random sample" onclick="predict_single();"><br>
	  
	  
      <textarea id="dumpjson"></textarea>
    </div>
    <div class="secpart">
      
      <div>
        Loss:<br>
        <canvas id="lossgraph">
        </canvas>
        <br>
        <input id="buttoncg" type="submit" value="clear graph" onclick="clear_graph();">
      </div>

      <div>
      <br>
      <textarea id="newnet" style="width:100%; height:200px;"></textarea><br>
      <input id="buttonnn" type="submit" value="change network" onclick="change_net();">
      </div>

    </div>
    <div style="clear:both;"></div>
  </div>

  <div class="divsec">
  <h1>Network Visualization</h1>
    <div id="visnet"><div class="layer ltinput"><div class="layer_act">Activations:<br><canvas class="actmap" width="48" height="48"></canvas></div><div class="ltitle">input (24x24x1)</div>max activation: 1, min: 0<br><div class="clear"></div></div><div class="layer ltconv"><div class="layer_act">Activations:<br><canvas class="actmap" width="48" height="48"></canvas><canvas class="actmap" width="48" height="48"></canvas><canvas class="actmap" width="48" height="48"></canvas><canvas class="actmap" width="48" height="48"></canvas><canvas class="actmap" width="48" height="48"></canvas><canvas class="actmap" width="48" height="48"></canvas><canvas class="actmap" width="48" height="48"></canvas><canvas class="actmap" width="48" height="48"></canvas><div>Weights:<br><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><br>Gradients:<br><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas></div></div><div class="ltitle">conv (24x24x8)</div>filter size 5x5x1, stride 1<br>max activation: 3.23964, min: -1.70001<br>parameters: 8x5x5x1+8 = 208<br><div class="clear"></div></div><div class="layer ltrelu"><div class="layer_act">Activations:<br><canvas class="actmap" width="48" height="48"></canvas><canvas class="actmap" width="48" height="48"></canvas><canvas class="actmap" width="48" height="48"></canvas><canvas class="actmap" width="48" height="48"></canvas><canvas class="actmap" width="48" height="48"></canvas><canvas class="actmap" width="48" height="48"></canvas><canvas class="actmap" width="48" height="48"></canvas><canvas class="actmap" width="48" height="48"></canvas></div><div class="ltitle">relu (24x24x8)</div>max activation: 3.23964, min: 0<br><div class="clear"></div></div><div class="layer ltpool"><div class="layer_act">Activations:<br><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas></div><div class="ltitle">pool (12x12x8)</div>pooling size 2x2, stride 2<br>max activation: 3.23964, min: 0<br><div class="clear"></div></div><div class="layer ltconv"><div class="layer_act">Activations:<br><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><div>Weights:<br><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><br>Gradients:<br><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas></div></div><div class="ltitle">conv (12x12x16)</div>filter size 5x5x8, stride 1<br>max activation: 4.16303, min: -9.33426<br>parameters: 16x5x5x8+16 = 3216<br><div class="clear"></div></div><div class="layer ltrelu"><div class="layer_act">Activations:<br><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas><canvas class="actmap" width="24" height="24"></canvas></div><div class="ltitle">relu (12x12x16)</div>max activation: 4.16303, min: 0<br><div class="clear"></div></div><div class="layer ltpool"><div class="layer_act">Activations:<br><canvas class="actmap" width="8" height="8"></canvas><canvas class="actmap" width="8" height="8"></canvas><canvas class="actmap" width="8" height="8"></canvas><canvas class="actmap" width="8" height="8"></canvas><canvas class="actmap" width="8" height="8"></canvas><canvas class="actmap" width="8" height="8"></canvas><canvas class="actmap" width="8" height="8"></canvas><canvas class="actmap" width="8" height="8"></canvas><canvas class="actmap" width="8" height="8"></canvas><canvas class="actmap" width="8" height="8"></canvas><canvas class="actmap" width="8" height="8"></canvas><canvas class="actmap" width="8" height="8"></canvas><canvas class="actmap" width="8" height="8"></canvas><canvas class="actmap" width="8" height="8"></canvas><canvas class="actmap" width="8" height="8"></canvas><canvas class="actmap" width="8" height="8"></canvas></div><div class="ltitle">pool (4x4x16)</div>pooling size 3x3, stride 3<br>max activation: 4.16303, min: 0<br><div class="clear"></div></div><div class="layer ltdropout"><div class="layer_act">Activations:<br><canvas class="actmap" width="8" height="8"></canvas><canvas class="actmap" width="8" height="8"></canvas><canvas class="actmap" width="8" height="8"></canvas><canvas class="actmap" width="8" height="8"></canvas><canvas class="actmap" width="8" height="8"></canvas><canvas class="actmap" width="8" height="8"></canvas><canvas class="actmap" width="8" height="8"></canvas><canvas class="actmap" width="8" height="8"></canvas><canvas class="actmap" width="8" height="8"></canvas><canvas class="actmap" width="8" height="8"></canvas><canvas class="actmap" width="8" height="8"></canvas><canvas class="actmap" width="8" height="8"></canvas><canvas class="actmap" width="8" height="8"></canvas><canvas class="actmap" width="8" height="8"></canvas><canvas class="actmap" width="8" height="8"></canvas><canvas class="actmap" width="8" height="8"></canvas></div><div class="ltitle">dropout (4x4x16)</div>max activation: 4.16303, min: 0<br><div class="clear"></div></div><div class="layer ltfc"><div class="layer_act">Activations:<br><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas></div><div class="ltitle">fc (1x1x10)</div>max activation: 4.61153, min: -2.74655<br>parameters: 10x256+10 = 2570<br><div class="clear"></div></div><div class="layer ltsoftmax"><div class="layer_act">Activations:<br><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas><canvas class="actmap" width="10" height="10"></canvas></div><div class="ltitle">softmax (1x1x10)</div>max activation: 0.91613, min: 0.00058<br><div class="clear"></div></div></div>
  </div>
  
  <div class="divsec">
  <h1>Example predictions on Test set</h1>
    <div id="testset_acc"><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:99px; margin-left: 60px; background-color:rgb(85,187,85);">7</div><div class="pp" style="width:0px; margin-left: 60px; background-color:rgb(187,85,85);">9</div><div class="pp" style="width:0px; margin-left: 60px; background-color:rgb(187,85,85);">0</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:83px; margin-left: 60px; background-color:rgb(85,187,85);">4</div><div class="pp" style="width:11px; margin-left: 60px; background-color:rgb(187,85,85);">9</div><div class="pp" style="width:2px; margin-left: 60px; background-color:rgb(187,85,85);">7</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:82px; margin-left: 60px; background-color:rgb(85,187,85);">4</div><div class="pp" style="width:7px; margin-left: 60px; background-color:rgb(187,85,85);">6</div><div class="pp" style="width:6px; margin-left: 60px; background-color:rgb(187,85,85);">0</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:95px; margin-left: 60px; background-color:rgb(85,187,85);">1</div><div class="pp" style="width:1px; margin-left: 60px; background-color:rgb(187,85,85);">9</div><div class="pp" style="width:0px; margin-left: 60px; background-color:rgb(187,85,85);">8</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:96px; margin-left: 60px; background-color:rgb(85,187,85);">3</div><div class="pp" style="width:1px; margin-left: 60px; background-color:rgb(187,85,85);">0</div><div class="pp" style="width:0px; margin-left: 60px; background-color:rgb(187,85,85);">2</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:62px; margin-left: 60px; background-color:rgb(187,85,85);">7</div><div class="pp" style="width:21px; margin-left: 60px; background-color:rgb(85,187,85);">2</div><div class="pp" style="width:8px; margin-left: 60px; background-color:rgb(187,85,85);">3</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:45px; margin-left: 60px; background-color:rgb(85,187,85);">7</div><div class="pp" style="width:20px; margin-left: 60px; background-color:rgb(187,85,85);">3</div><div class="pp" style="width:11px; margin-left: 60px; background-color:rgb(187,85,85);">1</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:27px; margin-left: 60px; background-color:rgb(187,85,85);">1</div><div class="pp" style="width:22px; margin-left: 60px; background-color:rgb(85,187,85);">2</div><div class="pp" style="width:19px; margin-left: 60px; background-color:rgb(187,85,85);">3</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:65px; margin-left: 60px; background-color:rgb(85,187,85);">2</div><div class="pp" style="width:26px; margin-left: 60px; background-color:rgb(187,85,85);">3</div><div class="pp" style="width:3px; margin-left: 60px; background-color:rgb(187,85,85);">0</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:42px; margin-left: 60px; background-color:rgb(85,187,85);">2</div><div class="pp" style="width:29px; margin-left: 60px; background-color:rgb(187,85,85);">0</div><div class="pp" style="width:13px; margin-left: 60px; background-color:rgb(187,85,85);">3</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:49px; margin-left: 60px; background-color:rgb(187,85,85);">3</div><div class="pp" style="width:48px; margin-left: 60px; background-color:rgb(85,187,85);">2</div><div class="pp" style="width:0px; margin-left: 60px; background-color:rgb(187,85,85);">6</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:72px; margin-left: 60px; background-color:rgb(85,187,85);">3</div><div class="pp" style="width:19px; margin-left: 60px; background-color:rgb(187,85,85);">7</div><div class="pp" style="width:4px; margin-left: 60px; background-color:rgb(187,85,85);">9</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:84px; margin-left: 60px; background-color:rgb(85,187,85);">3</div><div class="pp" style="width:9px; margin-left: 60px; background-color:rgb(187,85,85);">7</div><div class="pp" style="width:1px; margin-left: 60px; background-color:rgb(187,85,85);">9</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:60px; margin-left: 60px; background-color:rgb(85,187,85);">3</div><div class="pp" style="width:19px; margin-left: 60px; background-color:rgb(187,85,85);">7</div><div class="pp" style="width:12px; margin-left: 60px; background-color:rgb(187,85,85);">9</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:69px; margin-left: 60px; background-color:rgb(85,187,85);">9</div><div class="pp" style="width:16px; margin-left: 60px; background-color:rgb(187,85,85);">0</div><div class="pp" style="width:4px; margin-left: 60px; background-color:rgb(187,85,85);">5</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:41px; margin-left: 60px; background-color:rgb(187,85,85);">7</div><div class="pp" style="width:22px; margin-left: 60px; background-color:rgb(187,85,85);">3</div><div class="pp" style="width:19px; margin-left: 60px; background-color:rgb(187,85,85);">9</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:72px; margin-left: 60px; background-color:rgb(187,85,85);">9</div><div class="pp" style="width:8px; margin-left: 60px; background-color:rgb(187,85,85);">7</div><div class="pp" style="width:7px; margin-left: 60px; background-color:rgb(187,85,85);">4</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:98px; margin-left: 60px; background-color:rgb(85,187,85);">7</div><div class="pp" style="width:0px; margin-left: 60px; background-color:rgb(187,85,85);">9</div><div class="pp" style="width:0px; margin-left: 60px; background-color:rgb(187,85,85);">3</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:35px; margin-left: 60px; background-color:rgb(85,187,85);">4</div><div class="pp" style="width:31px; margin-left: 60px; background-color:rgb(187,85,85);">9</div><div class="pp" style="width:17px; margin-left: 60px; background-color:rgb(187,85,85);">6</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:81px; margin-left: 60px; background-color:rgb(85,187,85);">6</div><div class="pp" style="width:11px; margin-left: 60px; background-color:rgb(187,85,85);">1</div><div class="pp" style="width:2px; margin-left: 60px; background-color:rgb(187,85,85);">4</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:68px; margin-left: 60px; background-color:rgb(187,85,85);">3</div><div class="pp" style="width:20px; margin-left: 60px; background-color:rgb(187,85,85);">9</div><div class="pp" style="width:6px; margin-left: 60px; background-color:rgb(85,187,85);">5</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:32px; margin-left: 60px; background-color:rgb(187,85,85);">0</div><div class="pp" style="width:29px; margin-left: 60px; background-color:rgb(187,85,85);">4</div><div class="pp" style="width:29px; margin-left: 60px; background-color:rgb(187,85,85);">9</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:69px; margin-left: 60px; background-color:rgb(187,85,85);">0</div><div class="pp" style="width:6px; margin-left: 60px; background-color:rgb(187,85,85);">5</div><div class="pp" style="width:6px; margin-left: 60px; background-color:rgb(187,85,85);">3</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:55px; margin-left: 60px; background-color:rgb(187,85,85);">3</div><div class="pp" style="width:17px; margin-left: 60px; background-color:rgb(187,85,85);">7</div><div class="pp" style="width:10px; margin-left: 60px; background-color:rgb(85,187,85);">2</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:56px; margin-left: 60px; background-color:rgb(187,85,85);">1</div><div class="pp" style="width:15px; margin-left: 60px; background-color:rgb(85,187,85);">8</div><div class="pp" style="width:11px; margin-left: 60px; background-color:rgb(187,85,85);">3</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:53px; margin-left: 60px; background-color:rgb(187,85,85);">7</div><div class="pp" style="width:17px; margin-left: 60px; background-color:rgb(187,85,85);">3</div><div class="pp" style="width:12px; margin-left: 60px; background-color:rgb(187,85,85);">9</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:88px; margin-left: 60px; background-color:rgb(85,187,85);">0</div><div class="pp" style="width:3px; margin-left: 60px; background-color:rgb(187,85,85);">3</div><div class="pp" style="width:2px; margin-left: 60px; background-color:rgb(187,85,85);">2</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:92px; margin-left: 60px; background-color:rgb(85,187,85);">6</div><div class="pp" style="width:3px; margin-left: 60px; background-color:rgb(187,85,85);">4</div><div class="pp" style="width:1px; margin-left: 60px; background-color:rgb(187,85,85);">9</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:52px; margin-left: 60px; background-color:rgb(85,187,85);">9</div><div class="pp" style="width:18px; margin-left: 60px; background-color:rgb(187,85,85);">4</div><div class="pp" style="width:15px; margin-left: 60px; background-color:rgb(187,85,85);">7</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:74px; margin-left: 60px; background-color:rgb(187,85,85);">4</div><div class="pp" style="width:25px; margin-left: 60px; background-color:rgb(85,187,85);">7</div><div class="pp" style="width:0px; margin-left: 60px; background-color:rgb(187,85,85);">9</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:80px; margin-left: 60px; background-color:rgb(85,187,85);">4</div><div class="pp" style="width:11px; margin-left: 60px; background-color:rgb(187,85,85);">9</div><div class="pp" style="width:3px; margin-left: 60px; background-color:rgb(187,85,85);">7</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:58px; margin-left: 60px; background-color:rgb(85,187,85);">1</div><div class="pp" style="width:11px; margin-left: 60px; background-color:rgb(187,85,85);">9</div><div class="pp" style="width:9px; margin-left: 60px; background-color:rgb(187,85,85);">3</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:55px; margin-left: 60px; background-color:rgb(85,187,85);">4</div><div class="pp" style="width:31px; margin-left: 60px; background-color:rgb(187,85,85);">0</div><div class="pp" style="width:9px; margin-left: 60px; background-color:rgb(187,85,85);">6</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:23px; margin-left: 60px; background-color:rgb(187,85,85);">3</div><div class="pp" style="width:20px; margin-left: 60px; background-color:rgb(187,85,85);">5</div><div class="pp" style="width:19px; margin-left: 60px; background-color:rgb(85,187,85);">8</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:99px; margin-left: 60px; background-color:rgb(85,187,85);">7</div><div class="pp" style="width:0px; margin-left: 60px; background-color:rgb(187,85,85);">9</div><div class="pp" style="width:0px; margin-left: 60px; background-color:rgb(187,85,85);">3</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:93px; margin-left: 60px; background-color:rgb(85,187,85);">6</div><div class="pp" style="width:3px; margin-left: 60px; background-color:rgb(187,85,85);">0</div><div class="pp" style="width:1px; margin-left: 60px; background-color:rgb(187,85,85);">8</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:90px; margin-left: 60px; background-color:rgb(85,187,85);">1</div><div class="pp" style="width:3px; margin-left: 60px; background-color:rgb(187,85,85);">6</div><div class="pp" style="width:1px; margin-left: 60px; background-color:rgb(187,85,85);">8</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:26px; margin-left: 60px; background-color:rgb(85,187,85);">9</div><div class="pp" style="width:18px; margin-left: 60px; background-color:rgb(187,85,85);">4</div><div class="pp" style="width:17px; margin-left: 60px; background-color:rgb(187,85,85);">7</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:91px; margin-left: 60px; background-color:rgb(85,187,85);">0</div><div class="pp" style="width:3px; margin-left: 60px; background-color:rgb(187,85,85);">6</div><div class="pp" style="width:1px; margin-left: 60px; background-color:rgb(187,85,85);">3</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:42px; margin-left: 60px; background-color:rgb(85,187,85);">8</div><div class="pp" style="width:15px; margin-left: 60px; background-color:rgb(187,85,85);">1</div><div class="pp" style="width:15px; margin-left: 60px; background-color:rgb(187,85,85);">7</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:90px; margin-left: 60px; background-color:rgb(85,187,85);">4</div><div class="pp" style="width:7px; margin-left: 60px; background-color:rgb(187,85,85);">9</div><div class="pp" style="width:0px; margin-left: 60px; background-color:rgb(187,85,85);">7</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:99px; margin-left: 60px; background-color:rgb(85,187,85);">3</div><div class="pp" style="width:0px; margin-left: 60px; background-color:rgb(187,85,85);">8</div><div class="pp" style="width:0px; margin-left: 60px; background-color:rgb(187,85,85);">5</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:44px; margin-left: 60px; background-color:rgb(85,187,85);">7</div><div class="pp" style="width:28px; margin-left: 60px; background-color:rgb(187,85,85);">9</div><div class="pp" style="width:12px; margin-left: 60px; background-color:rgb(187,85,85);">1</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:78px; margin-left: 60px; background-color:rgb(187,85,85);">1</div><div class="pp" style="width:9px; margin-left: 60px; background-color:rgb(187,85,85);">7</div><div class="pp" style="width:4px; margin-left: 60px; background-color:rgb(187,85,85);">9</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:69px; margin-left: 60px; background-color:rgb(85,187,85);">9</div><div class="pp" style="width:9px; margin-left: 60px; background-color:rgb(187,85,85);">3</div><div class="pp" style="width:7px; margin-left: 60px; background-color:rgb(187,85,85);">4</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:33px; margin-left: 60px; background-color:rgb(85,187,85);">2</div><div class="pp" style="width:17px; margin-left: 60px; background-color:rgb(187,85,85);">3</div><div class="pp" style="width:13px; margin-left: 60px; background-color:rgb(187,85,85);">0</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:44px; margin-left: 60px; background-color:rgb(85,187,85);">1</div><div class="pp" style="width:16px; margin-left: 60px; background-color:rgb(187,85,85);">9</div><div class="pp" style="width:13px; margin-left: 60px; background-color:rgb(187,85,85);">3</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:93px; margin-left: 60px; background-color:rgb(85,187,85);">1</div><div class="pp" style="width:3px; margin-left: 60px; background-color:rgb(187,85,85);">7</div><div class="pp" style="width:1px; margin-left: 60px; background-color:rgb(187,85,85);">4</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:30px; margin-left: 60px; background-color:rgb(187,85,85);">3</div><div class="pp" style="width:24px; margin-left: 60px; background-color:rgb(187,85,85);">0</div><div class="pp" style="width:20px; margin-left: 60px; background-color:rgb(85,187,85);">2</div></div></div><div class="probsdiv"><canvas class="actmap" width="48" height="48"></canvas><div><div class="pp" style="width:78px; margin-left: 60px; background-color:rgb(85,187,85);">7</div><div class="pp" style="width:14px; margin-left: 60px; background-color:rgb(187,85,85);">3</div><div class="pp" style="width:3px; margin-left: 60px; background-color:rgb(187,85,85);">2</div></div></div></div>
  </div>

  </div>  
	
	<!--
	<textarea id="data_output" style="width:100%; height:200px;"></textarea><br>
	<canvas id = "put_here"> can't show </canvas>
	<canvas id = "mycanv">shit not loaded</canvas>	
	-->

</body></html>